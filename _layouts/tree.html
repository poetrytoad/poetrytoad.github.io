<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>{{ page:collection }}: {{ site.data.[page:collection].[page.title].name }}</title>
  <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="stylesheet" type="text/css" href="{{ site.baseurl }}/css/tree.css" />
  <link rel="alternate" type="application/rss+xml" title="{{ site.name }} - {{ site.description }}" href="{{ site.baseurl }}/feed.xml" />

</head>
<body>

  <nav>
    <h1><a href="{{ site.baseurl }}/">Family</a> › <a href="{{ site.baseurl }}/{{ page:collection }}">{{ page:collection }}</a></h1>
    {% for a in site.data.[page:collection].[page.title].anc reversed %}
    <a href="{{ a }}">{{ site.data.[page:collection].[a].name }}</a> ›
    {% endfor %}
    <span class="{{ site.data.[page.title].gen }}">{{ site.data.[page:collection].[page.title].name }}</span>
  </nav>

<article>
{% assign h=site.data.[page:collection].[page.title] %}
{% include header.liquid p=h %}

{% for p1 in site.data.[page:collection].[page.title].family.children %}

    {% if forloop.first %}<ul>{% endif %}
    <li>
    {% include import.liquid arg=p1 %}

    {% if !swap and q.family.first %}
        {% for each thisfam in q.family %}

            {% include loop.liquid p=q treelink=l from=swap fam=thisfam %} <!-- from here -->
            {% for p2 in thisfam.children %} <!-- to here for each fam IFF NOT SWAP -->

                {% if forloop.first %}<ul>{% endif %}
                    <li>
                    {% include import.liquid arg=p2 %}
                    {% include loop.liquid p=q treelink=l from=swap%} <!-- from here -->
                    {% for p3 in q.family.children %}  <!-- to here for each fam IFF NOT SWAP -->

                        {% if forloop.first %}<ul>{% endif %}
                        <li>
                        {% include loop.liquid p=p3 %}
                        </li>
                        {% if forloop.last %}</ul>{% endif %}

                    {% endfor %}
                    </li>
                    {% if forloop.last %}</ul>{% endif %}

            {% endfor %}
            </li>
            {% if forloop.last %}</ul>{% endif %}

        {% endfor %}
    {% else %}

        {% include loop.liquid p=q treelink=l from=swap %} <!-- from here -->
        {% for p2 in q.family.children %} <!-- to here for each fam IFF NOT SWAP -->

            {% if forloop.first %}<ul>{% endif %}
                <li>
                {% include import.liquid arg=p2 %}
                {% include loop.liquid p=q treelink=l from=swap%} <!-- from here -->
                {% for p3 in q.family.children %}  <!-- to here for each fam IFF NOT SWAP -->

                    {% if forloop.first %}<ul>{% endif %}
                    <li>
                    {% include loop.liquid p=p3 %}
                    </li>
                    {% if forloop.last %}</ul>{% endif %}

                {% endfor %}
                </li>
                {% if forloop.last %}</ul>{% endif %}

        {% endfor %}
        </li>
        {% if forloop.last %}</ul>{% endif %}

    {% endif %}


{% endfor %}
</article>

<script src="{{ site.baseurl }}/js/fold.js"></script>

<article>
{{ content }}
</article>

</body>
</html>
